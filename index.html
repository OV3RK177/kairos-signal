<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KAIROS WAR ROOM</title>
    <style>
        body { background-color: #050505; color: #00ff41; font-family: 'Courier New', monospace; margin: 0; padding: 20px; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        .top-bar { display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
        h1 { margin: 0; font-size: 20px; letter-spacing: 2px; }
        
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px; }
        .card { background: #0a0a0a; border: 1px solid #333; padding: 15px; }
        .val { font-size: 24px; font-weight: bold; color: #fff; margin: 5px 0; }
        .lbl { font-size: 10px; color: #666; text-transform: uppercase; }
        
        .main-split { display: flex; gap: 15px; flex-grow: 1; overflow: hidden; }
        .panel { flex: 1; border: 1px solid #333; display: flex; flex-direction: column; background: #000; }
        .panel-head { background: #111; padding: 5px 10px; font-size: 10px; color: #888; border-bottom: 1px solid #333; }
        .panel-body { padding: 10px; overflow-y: auto; font-size: 11px; flex-grow: 1; }
        
        /* Status Colors */
        .green { color: #00ff41; } .red { color: #ff5555; } .yellow { color: #f1fa8c; } .blue { color: #4da6ff; }
        
        table { width: 100%; border-collapse: collapse; }
        td { padding: 4px; border-bottom: 1px solid #111; }
    </style>
</head>
<body>

<div class="top-bar">
    <h1>KAIROS SIGNAL</h1>
    <div id="status" class="yellow">INITIALIZING...</div>
</div>

<div class="grid">
    <div class="card"><div class="lbl">TOTAL INTELLIGENCE</div><div class="val" id="stat-total">---</div></div>
    <div class="card"><div class="lbl">ACTIVE SHARDS</div><div class="val" id="stat-shards">---</div></div>
    <div class="card"><div class="lbl">VELOCITY</div><div class="val blue">HIGH FREQUENCY</div></div>
</div>

<div class="main-split">
    <div class="panel">
        <div class="panel-head">FIREHOSE LOGS</div>
        <div class="panel-body" id="logs"></div>
    </div>
    
    <div class="panel">
        <div class="panel-head">VOLATILITY MATRIX</div>
        <div class="panel-body">
            <table id="alpha-table"></table>
        </div>
    </div>
</div>

<script>
    const API = "http://159.203.91.55:8000";

    function log(msg, color="green") {
        const div = document.createElement('div');
        div.innerHTML = `<span style="color: #555">[${new Date().toLocaleTimeString()}]</span> <span class="${color}">${msg}</span>`;
        const container = document.getElementById('logs');
        container.prepend(div);
        if (container.children.length > 50) container.lastChild.remove();
    }

    async function refresh() {
        try {
            // 1. STATS
            const sRes = await fetch(`${API}/stats`);
            const sData = await sRes.json();
            document.getElementById('stat-total').innerText = parseInt(sData.estimated_data_points).toLocaleString();
            document.getElementById('stat-shards').innerText = sData.shard_count;
            document.getElementById('status').innerText = "SYSTEM: ONLINE";
            document.getElementById('status').className = "green";

            // 2. LOGS
            const lRes = await fetch(`${API}/logs`);
            const lData = await lRes.json();
            if (lData.live_feed) {
                lData.live_feed.reverse().forEach(line => {
                    let color = 'green';
                    if (line.includes('SLOT')) color = 'yellow';
                    if (line.includes('TRADE')) color = 'blue';
                    if (document.getElementById('logs').innerHTML.indexOf(line) === -1) {
                        log(line, color);
                    }
                });
            }

            // 3. ALPHA
            const aRes = await fetch(`${API}/alpha`);
            const aData = await aRes.json();
            if (aData.data) {
                const rows = aData.data.map(row => `
                    <tr>
                        <td style="color:#fff">${row.unique_id}</td>
                        <td class="blue">${parseFloat(row.Price_Mean).toFixed(2)}</td>
                        <td class="red">${parseFloat(row.Volatility_Risk).toFixed(4)}</td>
                    </tr>
                `).join('');
                document.getElementById('alpha-table').innerHTML = rows;
            }

        } catch (e) {
            document.getElementById('status').innerText = "CONNECTION FAILED";
            document.getElementById('status').className = "red";
            log(`ERROR: ${e.message}`, "red");
        }
    }

    log(`Attempting Uplink to ${API}...`, "yellow");
    setInterval(refresh, 1000);
</script>
</body>
</html>
